<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>分布式调度架构 | Tesla Z</title><meta name="keywords" content="分布式"><meta name="author" content="Tesla Z"><meta name="copyright" content="Tesla Z"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="分布式系统为用户任务寻找合适的服务器资源的过程叫做调度。分布式架构中调度器是一个非常重要的部分，调度器提供多种调度策略并完成具体的调度工作。常见的调度原理有单体调度、两层调度、共享状态调度。 单体调度 集群中只有一个节点运行调度进程，该节点对集群中的其他节点具有访问权限，可以搜集其他节点的状态、资源信息等进行统一管理，同时结合用户任务对资源的需求，在调度器中把任务与资源进行匹配并根据匹配结果将任务">
<meta property="og:type" content="article">
<meta property="og:title" content="分布式调度架构">
<meta property="og:url" content="https://teslazy.github.io/%E5%88%86%E5%B8%83%E5%BC%8F%E8%B0%83%E5%BA%A6%E6%9E%B6%E6%9E%84/index.html">
<meta property="og:site_name" content="Tesla Z">
<meta property="og:description" content="分布式系统为用户任务寻找合适的服务器资源的过程叫做调度。分布式架构中调度器是一个非常重要的部分，调度器提供多种调度策略并完成具体的调度工作。常见的调度原理有单体调度、两层调度、共享状态调度。 单体调度 集群中只有一个节点运行调度进程，该节点对集群中的其他节点具有访问权限，可以搜集其他节点的状态、资源信息等进行统一管理，同时结合用户任务对资源的需求，在调度器中把任务与资源进行匹配并根据匹配结果将任务">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://teslazy.github.io/%E5%88%86%E5%B8%83%E5%BC%8F%E8%B0%83%E5%BA%A6%E6%9E%B6%E6%9E%84/cover.jpg">
<meta property="article:published_time" content="2021-09-15T11:53:40.000Z">
<meta property="article:modified_time" content="2021-09-16T10:37:29.540Z">
<meta property="article:author" content="Tesla Z">
<meta property="article:tag" content="分布式">
<meta property="article:tag" content="学习笔记">
<meta property="article:tag" content="调度策略">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://teslazy.github.io/%E5%88%86%E5%B8%83%E5%BC%8F%E8%B0%83%E5%BA%A6%E6%9E%B6%E6%9E%84/cover.jpg"><link rel="shortcut icon" href="/img/myFavicon.JPG"><link rel="canonical" href="https://teslazy.github.io/%E5%88%86%E5%B8%83%E5%BC%8F%E8%B0%83%E5%BA%A6%E6%9E%B6%E6%9E%84/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//hm.baidu.com"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.css" media="print" onload="this.media='all'"><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?bca1bfbf24241c81c9c451794de9ef12";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#49b1f5","bgDark":"#121212","position":"bottom-center"},
  source: {
    jQuery: 'https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js',
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isanchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '分布式调度架构',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2021-09-16 18:37:29'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if (GLOBAL_CONFIG_SITE.isHome && /iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 5.4.0"></head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">加载中...</div></div></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/myFavicon.JPG" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data is-center"><div class="data-item"><a href="/archives/"><div class="headline">文章</div><div class="length-num">7</div></a></div><div class="data-item"><a href="/tags/"><div class="headline">标签</div><div class="length-num">10</div></a></div><div class="data-item"><a href="/categories/"><div class="headline">分类</div><div class="length-num">7</div></a></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 文档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 链接</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-star"></i><span> 关于我</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background: linear-gradient(20deg, #0062be, #925696, #cc426e, #fb0347)"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">Tesla Z</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 文档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 链接</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-star"></i><span> 关于我</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">分布式调度架构</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2021-09-15T11:53:40.000Z" title="发表于 2021-09-15 19:53:40">2021-09-15</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2021-09-16T10:37:29.540Z" title="更新于 2021-09-16 18:37:29">2021-09-16</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E5%88%86%E5%B8%83%E5%BC%8F/">分布式</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E5%88%86%E5%B8%83%E5%BC%8F/%E8%B0%83%E5%BA%A6%E7%AD%96%E7%95%A5/">调度策略</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">5.5k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>16分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="分布式调度架构"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><p>分布式系统为用户任务寻找合适的服务器资源的过程叫做<strong>调度</strong>。分布式架构中<strong>调度器</strong>是一个非常重要的部分，调度器提供多种调度策略并完成具体的调度工作。常见的调度原理有单体调度、两层调度、共享状态调度。</p>
<h1>单体调度</h1>
<p>集群中只有一个节点运行调度进程，该节点对集群中的其他节点具有访问权限，可以搜集其他节点的状态、资源信息等进行统一管理，同时结合用户任务对资源的需求，在调度器中把任务与资源进行匹配并根据匹配结果将任务指派给合适节点的调度方式叫做单体调度。</p>
<p><img src="%E5%8D%95%E4%BD%93%E8%B0%83%E5%BA%A6%E6%9E%B6%E6%9E%84.jpeg" alt="单体调度架构"></p>
<h2 id="单体调度设计">单体调度设计</h2>
<p>集群管理中单体调度模称为**单体调度器（Scheduler）**或者集中式调度器，是使用中心化的方式去管理资源、调度任务。调度器在系统中以单实例存在，所有资源请求和任务调度都通过这个实例进行。<strong>单体调度器拥有全局资源视图和全局任务，可以很容易地实现对任务的约束并实施全局性的调度策略</strong>。Google Borg、Kubernetes使用的就是单体调度设计。</p>
<h2 id="Borg调度设计">Borg调度设计</h2>
<h3 id="作业与任务">作业与任务</h3>
<p>调度的目的就是为作业或者任务寻找合适的资源，那么什么是作业与任务？</p>
<ul>
<li>作业：一个Borg作业包括名称、拥有者和任务个数，还有一些任务运行的约束（处理器、操作系统等）。一个作业只在一个集群中运行，一个作业可以包含多个任务，作业类似于用户在一次计算过程中要求计算机做的工作总和。</li>
<li>任务：任务是调度的基本单位，对应一组进程，运行在一台机器上或者一个容器内，任务是作业的一项项具体工作，多个任务可以在多台机器上执行。</li>
</ul>
<h3 id="调度算法">调度算法</h3>
<p><img src="Borg%E6%9E%B6%E6%9E%84.png" alt="Borg架构"></p>
<blockquote>
<p>Scheduler 负责任务的调度，当用户提交一个作业给 BorgMaster 后，BorgMaster 会把该作业保存到 Paxos 仓库中，并将这个作业的所有任务加入等待队列中。调度器异步地扫描等待队列，将任务分配到满足作业约束且有足够资源的计算节点上。</p>
</blockquote>
<p>Borg调度算法的核心思想包括两个阶段：</p>
<ol>
<li>可行性检查：寻找一组可以运行任务的机器（Borglet），调度器会找一组满足任务约束并且有足够资源的机器</li>
<li>评分取优：从可行的机器中选择评分高的机器（Borglet）执行任务。调度器确定每台可行机器的适宜性，Borg 根据评分机制，对可行性检查阶段中筛选出的机器进行打分，选出最适合调度的一台机器。</li>
</ol>
<h4 id="评分算法">评分算法</h4>
<ul>
<li>
<p>最差匹配：该算法的核心是将任务尽量分散到不同的机器上。该算法的问题在于，它会导致每个机器都有少量的无法使用的剩余资源，因此有时称其为“<strong>最差匹配</strong>”（worst fit）。</p>
<blockquote>
<p>比如，现在有两个机器，机器 A 的空闲资源为 1 个 CPU 和 1G 内存、机器 B 的空闲资源为 0.8 个 CPU 和 1.2G 内存；同时有两个任务，Task1 的资源需求为 0.4 个 CPU 和 0.3G 内存、Task2 的资源需求为 0.3CPU 和 0.5G 内存。按照最差匹配算法思想，Task1 和 Task2 会分别分配到机器 A 和机器 B 上，导致机器 A 和机器 B 都存在一些资源碎片，可能无法再运行其他 Task。</p>
</blockquote>
</li>
<li>
<p>最佳匹配：该算法追求把机器上的任务塞得越满越好。这样就可以“空”出一些没有用户作业的机器（它们仍运行存储服务），来直接放置大型任务。</p>
</li>
</ul>
<p>这两个评分算法各有利弊，应用中需要根据实际情况来选择更适宜的评分算法。比如，对于资源比较紧缺，且业务流量比较规律，基本不会出现突发情况的场景，可以选择最佳匹配算法；如果资源比较丰富，且业务流量会经常出现突发情况的场景，可以选择最差匹配算法。</p>
<blockquote>
<p>单体调度是针对一个集群或一个数据中心的，那么多个集群或多个数据中心如何实现单体调度？</p>
<p>答案是<strong>集群联邦</strong>。所谓集群联邦，就是将多个集群联合起来工作，核心思想是增加一个控制中心，由它提供统一对外接口，多个集群的 Master 向这个控制中心进行注册，控制中心会管理所有注册集群的状态和资源信息，控制中心接收到任务后会根据任务和集群信息进行调度匹配，选择到合适的集群后，将任务发送给相应的集群去执行。<strong>集群联邦的概念，其实就是单体调度的分层实现</strong>。</p>
</blockquote>
<h1>两层调度</h1>
<p>单体调度的中央服务器容易出现单点瓶颈，并且限制了调度规模和支持的服务类型，针对这些问题就有了改进方案——两层调度结构。</p>
<blockquote>
<p>为什们单体调度会限制支持的服务类型？</p>
<p>不同服务具有不同特征，对调度和计算的要求也不一样，单体调度框架会随着任务类型增加而变的复杂，比如开始只有批处理，后面又增加了流数据任务，后面又有新的任务加入，最终变得难以扩展和维护。</p>
</blockquote>
<p><img src="%E4%B8%A4%E5%B1%82%E8%B0%83%E5%BA%A6%E6%9E%B6%E6%9E%84.jpeg" alt="两层调度架构"></p>
<p><strong>两层调度结构把资源和任务分开调度，一层调度器只负责资源管理和分配，另外一层调度器负责任务与资源的匹配</strong>。第一层仍是一个简化的中央调度器，第二层调度有各个应用程序框架完成，可以有多种调度器，从而能够支持不同的任务类型。中央调度器从整体上管理资源，并分配给二层调度器，二层调度器再根据具体任务将资源和任务匹配。</p>
<h2 id="Mesos调度设计">Mesos调度设计</h2>
<p>Mesos是一个典型的双层调度框架，Mesos包括资源管理集群（第一层）和框架（第二层）。Mesos 本身实现的调度器Allocation Module为第一层调度，负责资源管理，然后将第二层任务调度交给了框架完成。</p>
<p><img src="Mesos.jpeg" alt="Mesos调度设计"></p>
<ul>
<li>资源管理集群是由一个 Master 节点和多个 Slave 节点组成的集中式系统。每个集群有且仅有一个 Master 节点，负责管理 Slave 节点，并对接上层框架；Slave 节点向 Master 节点周期汇报资源状态信息，并执行框架提交的任务。</li>
<li>框架（Framework）运行在 Mesos 上，是负责应用管理与调度的“组件”，比如 Hadoop、Spark、MPI 和 Marathon 等，不同的框架用于完成不同的任务，比如批处理任务、实时分析任务等。框架主要由调度器（Scheduler）和执行器（Executor）组成，调度器可以从 Master 节点获取集群节点的信息 ，执行器在 Slave 节点上执行任务。</li>
</ul>
<h3 id="基本原理">基本原理</h3>
<ol>
<li>框架向 Mesos Master 注册；</li>
<li>Mesos Slave 节点定期或周期向 Mesos Master 上报本节点的空闲资源；</li>
<li>Mesos Master 的 Scheduler 进程收集所有节点的空闲资源信息，并以 Resource Offer 的方式将空闲资源发送给注册的框架；</li>
<li>框架的 Scheduler 接收到 Mesos 发送的资源后，进行任务调度与匹配，匹配成功后，将匹配结果下发给 Mesos Master，并由 Mesos Master 转发给相应节点的执行器执行任务。</li>
</ol>
<p>Mesos 采用 Resource Offer 机制衔接了第一层和第二层调度。通过 Resource Offer 机制，第一层调度将资源主动告知第二层调度，然后第二层调度进行具体的任务匹配，从而实现了任务调度与资源管理的分离。</p>
<blockquote>
<p>**Resource Offer 机制是指Mesos Master 主动将节点空闲资源，以类似发放（Offer）的方式发给每个框架，如果框架需要则使用，不需要则还回。</p>
</blockquote>
<p>Mesos Master 通过资源分配算法决定给各个 Framework 提供多少资源，而 Framework 则决定接受哪些资源，以及哪些任务使用这些资源运行。第二层框架层的调度策略根据具体实现而各有不同，例如Hadoop、Spark各自的调度策略，这里不做详细介绍。</p>
<h3 id="第一层调度资源分配算法">第一层调度资源分配算法</h3>
<h4 id="最大最小公平算法-绝对公平">最大最小公平算法 - 绝对公平</h4>
<p>这是一种尽可能让更多资源需求方满意并且兼顾公平的算法，有3个主要原则：</p>
<ol>
<li>按照用户对资源需求量递增的顺序进行空闲资源分配；</li>
<li>不存在用户得到的资源超过自己需求的情况；</li>
<li>对于分配的资源不满足需求的用户，所获得的资源是相等的。</li>
</ol>
<p>分配资源时按照以上原则多次迭代，直到满足所有用户的资源需求或者资源已被全部分配完毕，迭代结束。</p>
<blockquote>
<p>具体例子：</p>
<p>假设，现在有总量为 100 的空闲资源，有 4 个用户 A、B、C、D 对该资源的需求量分别为（35，10，25，45），分配流程如下所示：</p>
<ol>
<li>按照用户对资源的需求量升序排列，则 4 个用户的需求量为（B:10，C:25，A:35，D:45）。</li>
<li>平均分配空闲资源。资源空闲总量 100，除以用户数 4，则平均空闲资源量为 25；按照第一步中需求量分配后，用户资源需求量为（0，0，10，20），且用户 B 由于资源需求量小于 25，因此会剩余资源。此时空闲资源量为 15，资源需求人数为 2。</li>
<li>重复第二步，平均分配资源，15/2=7.5，即分别为用户 A 和 D 分配 7.5 份资源，此时用户资源需求量为（0，0，2.5，12.5），空闲资源量为 0，资源需求人数为 2。</li>
<li>所有资源已分配完，算法终止。</li>
</ol>
</blockquote>
<p>可以看出最大最小公平算法采用了绝对公平的方式分配资源，但是有可能会导致大量的资源浪费，比如上述例子中用户A（需求量为 35） 、用户D（需求量为 45）虽然公平分配了 32.5 的空闲资源，但由于资源不满足需求，A、D用户均无法执行任务。</p>
<h4 id="主导资源公平算法-尽可能满足更多用户">主导资源公平算法 - 尽可能满足更多用户</h4>
<p>主导资源公平算法在考虑用户公平性的前提下，还考虑了用户对不同资源类型的需求，以尽可能地合理分配资源，尽可能地满足更多的用户。</p>
<p>针对多种资源的需求，主导资源公平算法首先计算已经分配给用户的每一种资源的占用率（Resource Share）。所有资源占用率中的最大值称作该<strong>用户的主导资源占用率</strong>，而主导资源占用率对应的资源就是用户的主导资源。</p>
<ul>
<li>具体例子：</li>
</ul>
<p><img src="%E4%B8%BB%E5%AF%BC%E8%B5%84%E6%BA%90%E5%85%AC%E5%B9%B3%E7%AE%97%E6%B3%95.jpeg" alt="主导资源公平算法"></p>
<p>假设系统中的资源共包括 18 个 CPU 和 36 GB 内存，有两个 Framework（Framework A 和 Framework B）分别运行了两种任务，假设 Framework A 运行内存密集型任务，Framework B 运行 CPU 密集型任务，且每个任务所需要的资源量是一致的，分别是 &lt;2 CPU, 8 GB&gt; 和 &lt;6 CPU, 2 GB&gt;。</p>
<ol>
<li>
<p>第一步：计算资源分配量。<br>
假设 x 和 y 分别是 Framework A 和 Framework B 分配的任务数，那么 Framework A 消耗的资源为{2x CPU，8x GB}，Framework B 消耗的资源数为{6y CPU，2y GB}，分配给两个 Framework 的总资源量为（2x+6y）个 CPU 和（8x+2y）GB 内存。</p>
</li>
<li>
<p>第二步：确定主导资源。<br>
对于 Framework A 来说，每个任务要消耗总 CPU 资源的 2/18，总内存资源的 8/36，所以 Framework A 的主导资源为内存；对于 Framework B 来说，每个任务要消耗总 CPU 资源的 6/18 和总内存资源的 2/36，因而 Framework B 的主导资源为 CPU。</p>
</li>
<li>
<p>第三步：DRF 算法的核心是平衡所有用户的主导资源占用率，尽可能试图最大化所有用户中最小的主导资源占用率。在满足公式的条件下，使得 x 和 y 越大越好。通过求解可以得出：x=3，y=2，每个 Framework 获取了相同比例的主导资源，即：A 获取了 2/3 的内存，B 获取了 2/3 的 CPU。</p>
</li>
</ol>
<p>在实际任务分配过程中，主导资源率是根据已经分配给 Framework 的资源，占集群中总资源量的多少进行计算的，并且在每次分配过程中，会选择主导资源最小的 Framework 进行分配，也就是试图最大化所有用户中最小的主导资源占用率。</p>
<blockquote>
<p>主导资源公平算法更多知识可参考“<a target="_blank" rel="noopener" href="https://cs.stanford.edu/~matei/papers/2011/nsdi_drf.pdf">Dominant Resource Fairness: Fair Allocation of Multiple Resource Types</a>”这篇论文</p>
</blockquote>
<h3 id="算法对比">算法对比</h3>
<ul>
<li>最大最小公平算法适用于单一类型的资源分配场景，最大最小公平算法从公平的角度出发，为每个用户分配不多于需求量的资源；</li>
<li>主导资源公平算法适用于多种类型资源混合的场景，从任务出发，目的在于尽量充分利用资源使得能够执行的任务越多越好。</li>
</ul>
<h1>共享状态调度</h1>
<p>共享状态调度沿用了单体调度器的模式，但将单体调度器分解为了<strong>多个调度器</strong>，每个调度器都有全局的资源状态信息，能够实现最优的任务调度，也提供了更好的可扩展性。</p>
<p>这种调度架构在支持多种任务类型的同时，还能拥有全局的资源状态信息。这种调度架构的多个调度器能共享集群的资源状态、任务状态等，我们称这种调度架构为<strong>共享状态调度器</strong>。</p>
<p><img src="%E5%85%B1%E4%BA%AB%E7%8A%B6%E6%80%81%E8%B0%83%E5%BA%A6%E6%9E%B6%E6%9E%84.jpeg" alt="共享状态调度架构"></p>
<ul>
<li>State Storage：资源维护模块，负责储存并维护资源和任务的状态，以便Scheduler查询资源状态和调度任务</li>
<li>Resource Pool：节点集群，接受并实行Scheduler调度的任务</li>
<li>Scheduler：任务调度操作</li>
</ul>
<p>共享状态调度的典型代表有 Google 的 Omega、微软的 Apollo，以及 Hashicorp 的 Nomad 容器调度器，下面我们介绍下Omega调度架构。</p>
<h2 id="Omega调度设计">Omega调度设计</h2>
<p>Omega 在设计时参考了 Borg 的设计，吸收了 Borg 的优点，并改进了其不足之处。</p>
<p><img src="Omega%E8%B0%83%E5%BA%A6%E6%9E%B6%E6%9E%84.jpeg" alt="Omega调度架构"></p>
<h3 id="名词解释">名词解释</h3>
<ul>
<li>Cell：每个 Cell 管理着部分物理集群，一个集群有多个 Cell，可以将“Cell”理解为一个集群的子集群或子节点的集合。</li>
<li>State Storage：负责存储和维护资源及任务状态，里面有一个 Cell State 文件，记录着全局共享的集群状态（主本）。</li>
<li>Scheduler：调度器——资源分配决策者，每个调度器私有一份Cell State副本，调度器可以查看 Cell 的整个状态，并申请任何可用的集群资源。一旦调度器做出资源调度决策，它就会在原子提交中更新本地的 Cell State 的资源状态副本。若同时有多个调度器申请同一份资源，State Storage 模块可以根据任务的优先级，选择优先级最高的那个任务进行调度。</li>
</ul>
<p>在 Omega 系统中，每个调度器都具有对整个集群资源的访问权限，从而允许多个调度器自由地竞争空闲资源，并在更新集群状态时使用乐观并发控制来调解资源冲突问题，这样就有效地解决了两层调度中 Framework 只拥有局部资源导致的无法实现全局最优的问题。</p>
<h3 id="工作原理">工作原理</h3>
<p>Omega将集群中资源的使用和任务的调度当作数据库中的一条条事务进行管理。数据库是一个共享的状态，对应 Omega 中的 Cell State，而每个调度器都要根据数据库的信息（即集群的资源信息）去独立完成自己的任务调度策略。</p>
<p><img src="Omega%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86.jpeg" alt="Omega工作原理"></p>
<p>在一个应用执行的过程中，调度器会将一个 Job 中的所有 Task 与 Resource 进行匹配。调度器会设置多个 Checkpoint 来检测 Resource 是否都已经被占用，只有这个 Job 的所有 Task 可以匹配到可用资源时，这个 Job 才可以被调度；如果存在 Task 匹配不到可用资源，那么这个事务需要执行回滚操作，Job 调度失败。</p>
<p>无论事务是否执行成功，调度器都会在事务执行之后，重新从主本那里同步更新本地 Cell State 的资源状态副本，以保证本地集群信息状态的有效性。若事务未成功执行，则调度器会在必要时重新运行其调度算法并再次尝试申请资源。</p>
<ul>
<li>调度器对 Job 的调度是具有原子性的，一个 Job 的所有 Task 都是一起调度的，即使部分 Task 调度失败了，调度器再次调度时也必须再次调度整个 Job。</li>
<li>多个调度器可以并行调度，无需等待其他调度器调度结果，若存在冲突时，进行冲突处理，比如根据 Job 的优先级，优先级高则获得资源。</li>
</ul>
<p><strong>Omega</strong>采用了传统数据库中的乐观锁（MVCC，Multi-Version Concurrency Control，基于多版本的并发访问控制），即每一个应用都发放了所有的可用资源，在更新集群状态时使用乐观并发控制来解决资源冲突问题，来提高 Omega 的并发度。</p>
<p>不同的 Omega 调度器可以实现不同的策略，但有一些调度规则是所有调度器必须达成一致的，比如哪些资源是允许分配的、如何评估作业的优先级等。<strong>Omega 调度器将两层调度器中的集中式资源调度模块简化成了一些持久化的共享数据（状态）和针对这些数据的验证代码</strong>。而这里的“共享数据”，实际上就是整个集群的实时资源状态信息；而验证代码就是解决调度冲突的调度规则。</p>
<h1>总结</h1>
<p>集群中需要管理的对象主要包括两类：</p>
<ul>
<li>资源的分配和使用状态</li>
<li>任务的调度和执行状态</li>
</ul>
<p><img src="%E4%B8%89%E7%A7%8D%E6%9E%B6%E6%9E%84%E6%AF%94%E8%BE%83.jpeg" alt="三种架构比较"></p>
<p>单体调度中，这两种对象都是由单体调度器管理的，中央调度器拥有整个集群的节点资源信息，可以实现全局最优调度。但它的缺点是，无调度并发性，且中央服务器存在单点瓶颈问题，导致支持的调度规模和服务类型受限，同时会限制集群的调度效率。单体调度适用于小规模集群。</p>
<p>两层调度中，这两种对象分别由第一层中央调度器和第二层 Framework 调度器管理，第一层调度器负责集群资源管理，并将可用资源发送给第二层调度；第二层调度接收到第一层调度发送的资源，进行任务调度。由于 Framwork 调度器只能看到部分资源，因此不能保证全局状态的一致性，任务匹配算法无法实现全局最优；两层调度是悲观并发调度，在执行任务之前避免冲突。双层调度适用于中等规模集群。</p>
<p>共享状态调度存在多个调度器，每个调度器都拥有集群全局的资源状态信息，因此任务匹配算法可以实现全局最优性。同时该调度采用了乐观并发调度，在执行了任务匹配算法后，调度器将其调度结果提交给 State Storage，由其决定是否进行本次调度，从而解决竞争同一种资源而引起的冲突问题。但是如果没有妥善处理资源竞争的问题，则很可能会产生资源冲突，从而导致任务调度失败。这时，用户就需要对调度失败的任务进行处理，比如重新调度、任务调度状态维护等，从而进一步增加了任务调度操作的复杂度。共享状态调度适合大规模集群。</p>
<blockquote>
<p><strong>乐观并发调度和悲观并发调度</strong></p>
<p>乐观并发调度，强调事后检测，在事务提交时检查是否避免了冲突：若避免，则提交；否则回滚并自动重新执行。也就是说，它是在执行任务匹配调度算法后，待计算出结果后再进行冲突检测。</p>
<p>悲观并发调度，强调事前预防，在事务执行时检查是否会存在冲突。不存在，则继续执行；否则等待或回滚。也就是说，在执行任务匹配调度算法前，通过给不同的 Framework 发送不同的资源，以避免冲突。</p>
</blockquote>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">Tesla Z</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://teslazy.github.io/%E5%88%86%E5%B8%83%E5%BC%8F%E8%B0%83%E5%BA%A6%E6%9E%B6%E6%9E%84/">https://teslazy.github.io/%E5%88%86%E5%B8%83%E5%BC%8F%E8%B0%83%E5%BA%A6%E6%9E%B6%E6%9E%84/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://teslazy.github.io" target="_blank">Tesla Z</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E5%88%86%E5%B8%83%E5%BC%8F/">分布式</a><a class="post-meta__tags" href="/tags/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">学习笔记</a><a class="post-meta__tags" href="/tags/%E8%B0%83%E5%BA%A6%E7%AD%96%E7%95%A5/">调度策略</a></div><div class="post_share"><div class="social-share" data-image="/%E5%88%86%E5%B8%83%E5%BC%8F%E8%B0%83%E5%BA%A6%E6%9E%B6%E6%9E%84/cover.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="next-post pull-full"><a href="/%E5%88%86%E5%B8%83%E5%BC%8F%E4%BD%93%E7%B3%BB%E7%BB%93%E6%9E%84/"><img class="next-cover" src="/%E5%88%86%E5%B8%83%E5%BC%8F%E4%BD%93%E7%B3%BB%E7%BB%93%E6%9E%84/cover.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">分布式体系结构</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/%E5%88%86%E5%B8%83%E5%BC%8F%E7%BB%BC%E8%BF%B0/" title="分布式综述"><img class="cover" src="/%E5%88%86%E5%B8%83%E5%BC%8F%E7%BB%BC%E8%BF%B0/cover.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-09-08</div><div class="title">分布式综述</div></div></a></div><div><a href="/%E5%88%86%E5%B8%83%E5%BC%8F%E5%8D%8F%E8%B0%83%E4%B8%8E%E5%90%8C%E6%AD%A5%E2%80%94%E2%80%94%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5%E4%B8%8E%E7%AE%97%E6%B3%95/" title="分布式协调与同步——基本概念与算法"><img class="cover" src="/%E5%88%86%E5%B8%83%E5%BC%8F%E5%8D%8F%E8%B0%83%E4%B8%8E%E5%90%8C%E6%AD%A5%E2%80%94%E2%80%94%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5%E4%B8%8E%E7%AE%97%E6%B3%95/cover.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-09-08</div><div class="title">分布式协调与同步——基本概念与算法</div></div></a></div><div><a href="/%E5%88%86%E5%B8%83%E5%BC%8F%E5%8D%8F%E8%B0%83%E4%B8%8E%E5%90%8C%E6%AD%A5%E2%80%94%E2%80%94%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1/" title="分布式协调与同步——分布式事务"><img class="cover" src="/%E5%88%86%E5%B8%83%E5%BC%8F%E5%8D%8F%E8%B0%83%E4%B8%8E%E5%90%8C%E6%AD%A5%E2%80%94%E2%80%94%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1/cover.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-09-13</div><div class="title">分布式协调与同步——分布式事务</div></div></a></div><div><a href="/%E5%88%86%E5%B8%83%E5%BC%8F%E5%8D%8F%E8%B0%83%E4%B8%8E%E5%90%8C%E6%AD%A5%E2%80%94%E2%80%94%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81/" title="分布式协调与同步——分布式锁"><img class="cover" src="/%E5%88%86%E5%B8%83%E5%BC%8F%E5%8D%8F%E8%B0%83%E4%B8%8E%E5%90%8C%E6%AD%A5%E2%80%94%E2%80%94%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81/cover.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-09-13</div><div class="title">分布式协调与同步——分布式锁</div></div></a></div><div><a href="/%E5%88%86%E5%B8%83%E5%BC%8F%E4%BD%93%E7%B3%BB%E7%BB%93%E6%9E%84/" title="分布式体系结构"><img class="cover" src="/%E5%88%86%E5%B8%83%E5%BC%8F%E4%BD%93%E7%B3%BB%E7%BB%93%E6%9E%84/cover.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-09-15</div><div class="title">分布式体系结构</div></div></a></div></div></div><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div id="utterances-wrap"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/img/myFavicon.JPG" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">Tesla Z</div><div class="author-info__description"></div></div><div class="card-info-data is-center"><div class="card-info-data-item"><a href="/archives/"><div class="headline">文章</div><div class="length-num">7</div></a></div><div class="card-info-data-item"><a href="/tags/"><div class="headline">标签</div><div class="length-num">10</div></a></div><div class="card-info-data-item"><a href="/categories/"><div class="headline">分类</div><div class="length-num">7</div></a></div></div><a class="button--animated" id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/TeslaZY"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/teslazy" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="mailto:teslazy@outlook.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a><a class="social-icon" href="https://weibo.com/u/3547380305" target="_blank" title="Weibo"><i class="fab fa-weibo"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn card-announcement-animation"></i><span>公告</span></div><div class="announcement_content">3th anniversary, love u</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-text">单体调度</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8D%95%E4%BD%93%E8%B0%83%E5%BA%A6%E8%AE%BE%E8%AE%A1"><span class="toc-text">单体调度设计</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Borg%E8%B0%83%E5%BA%A6%E8%AE%BE%E8%AE%A1"><span class="toc-text">Borg调度设计</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%9C%E4%B8%9A%E4%B8%8E%E4%BB%BB%E5%8A%A1"><span class="toc-text">作业与任务</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%B0%83%E5%BA%A6%E7%AE%97%E6%B3%95"><span class="toc-text">调度算法</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AF%84%E5%88%86%E7%AE%97%E6%B3%95"><span class="toc-text">评分算法</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-text">两层调度</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Mesos%E8%B0%83%E5%BA%A6%E8%AE%BE%E8%AE%A1"><span class="toc-text">Mesos调度设计</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E5%8E%9F%E7%90%86"><span class="toc-text">基本原理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC%E4%B8%80%E5%B1%82%E8%B0%83%E5%BA%A6%E8%B5%84%E6%BA%90%E5%88%86%E9%85%8D%E7%AE%97%E6%B3%95"><span class="toc-text">第一层调度资源分配算法</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9C%80%E5%A4%A7%E6%9C%80%E5%B0%8F%E5%85%AC%E5%B9%B3%E7%AE%97%E6%B3%95-%E7%BB%9D%E5%AF%B9%E5%85%AC%E5%B9%B3"><span class="toc-text">最大最小公平算法 - 绝对公平</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%BB%E5%AF%BC%E8%B5%84%E6%BA%90%E5%85%AC%E5%B9%B3%E7%AE%97%E6%B3%95-%E5%B0%BD%E5%8F%AF%E8%83%BD%E6%BB%A1%E8%B6%B3%E6%9B%B4%E5%A4%9A%E7%94%A8%E6%88%B7"><span class="toc-text">主导资源公平算法 - 尽可能满足更多用户</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AE%97%E6%B3%95%E5%AF%B9%E6%AF%94"><span class="toc-text">算法对比</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-text">共享状态调度</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Omega%E8%B0%83%E5%BA%A6%E8%AE%BE%E8%AE%A1"><span class="toc-text">Omega调度设计</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%90%8D%E8%AF%8D%E8%A7%A3%E9%87%8A"><span class="toc-text">名词解释</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86"><span class="toc-text">工作原理</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-text">总结</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/%E5%88%86%E5%B8%83%E5%BC%8F%E8%B0%83%E5%BA%A6%E6%9E%B6%E6%9E%84/" title="分布式调度架构"><img src="/%E5%88%86%E5%B8%83%E5%BC%8F%E8%B0%83%E5%BA%A6%E6%9E%B6%E6%9E%84/cover.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="分布式调度架构"/></a><div class="content"><a class="title" href="/%E5%88%86%E5%B8%83%E5%BC%8F%E8%B0%83%E5%BA%A6%E6%9E%B6%E6%9E%84/" title="分布式调度架构">分布式调度架构</a><time datetime="2021-09-15T11:53:40.000Z" title="发表于 2021-09-15 19:53:40">2021-09-15</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/%E5%88%86%E5%B8%83%E5%BC%8F%E4%BD%93%E7%B3%BB%E7%BB%93%E6%9E%84/" title="分布式体系结构"><img src="/%E5%88%86%E5%B8%83%E5%BC%8F%E4%BD%93%E7%B3%BB%E7%BB%93%E6%9E%84/cover.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="分布式体系结构"/></a><div class="content"><a class="title" href="/%E5%88%86%E5%B8%83%E5%BC%8F%E4%BD%93%E7%B3%BB%E7%BB%93%E6%9E%84/" title="分布式体系结构">分布式体系结构</a><time datetime="2021-09-15T06:24:54.000Z" title="发表于 2021-09-15 14:24:54">2021-09-15</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/%E5%88%86%E5%B8%83%E5%BC%8F%E5%8D%8F%E8%B0%83%E4%B8%8E%E5%90%8C%E6%AD%A5%E2%80%94%E2%80%94%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81/" title="分布式协调与同步——分布式锁"><img src="/%E5%88%86%E5%B8%83%E5%BC%8F%E5%8D%8F%E8%B0%83%E4%B8%8E%E5%90%8C%E6%AD%A5%E2%80%94%E2%80%94%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81/cover.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="分布式协调与同步——分布式锁"/></a><div class="content"><a class="title" href="/%E5%88%86%E5%B8%83%E5%BC%8F%E5%8D%8F%E8%B0%83%E4%B8%8E%E5%90%8C%E6%AD%A5%E2%80%94%E2%80%94%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81/" title="分布式协调与同步——分布式锁">分布式协调与同步——分布式锁</a><time datetime="2021-09-13T10:52:45.000Z" title="发表于 2021-09-13 18:52:45">2021-09-13</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/%E5%88%86%E5%B8%83%E5%BC%8F%E5%8D%8F%E8%B0%83%E4%B8%8E%E5%90%8C%E6%AD%A5%E2%80%94%E2%80%94%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1/" title="分布式协调与同步——分布式事务"><img src="/%E5%88%86%E5%B8%83%E5%BC%8F%E5%8D%8F%E8%B0%83%E4%B8%8E%E5%90%8C%E6%AD%A5%E2%80%94%E2%80%94%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1/cover.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="分布式协调与同步——分布式事务"/></a><div class="content"><a class="title" href="/%E5%88%86%E5%B8%83%E5%BC%8F%E5%8D%8F%E8%B0%83%E4%B8%8E%E5%90%8C%E6%AD%A5%E2%80%94%E2%80%94%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1/" title="分布式协调与同步——分布式事务">分布式协调与同步——分布式事务</a><time datetime="2021-09-13T10:52:25.000Z" title="发表于 2021-09-13 18:52:25">2021-09-13</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/%E5%88%86%E5%B8%83%E5%BC%8F%E5%8D%8F%E8%B0%83%E4%B8%8E%E5%90%8C%E6%AD%A5%E2%80%94%E2%80%94%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5%E4%B8%8E%E7%AE%97%E6%B3%95/" title="分布式协调与同步——基本概念与算法"><img src="/%E5%88%86%E5%B8%83%E5%BC%8F%E5%8D%8F%E8%B0%83%E4%B8%8E%E5%90%8C%E6%AD%A5%E2%80%94%E2%80%94%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5%E4%B8%8E%E7%AE%97%E6%B3%95/cover.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="分布式协调与同步——基本概念与算法"/></a><div class="content"><a class="title" href="/%E5%88%86%E5%B8%83%E5%BC%8F%E5%8D%8F%E8%B0%83%E4%B8%8E%E5%90%8C%E6%AD%A5%E2%80%94%E2%80%94%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5%E4%B8%8E%E7%AE%97%E6%B3%95/" title="分布式协调与同步——基本概念与算法">分布式协调与同步——基本概念与算法</a><time datetime="2021-09-08T05:41:47.000Z" title="发表于 2021-09-08 13:41:47">2021-09-08</time></div></div></div></div></div></div></main><footer id="footer" style="background: linear-gradient(20deg, #0062be, #925696, #cc426e, #fb0347)"><div id="footer-wrap"><div class="copyright">&copy;2018 - 2021 By Tesla Z</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">简</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="chat_btn" type="button" title="rightside.chat_btn"><i class="fas fa-sms"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><div class="search-dialog__title" id="local-search-title">本地搜索</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div></div><hr/><div id="local-search-results"></div><span class="search-close-button"><i class="fas fa-times"></i></span></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.js"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><script src="/js/search/local-search.js"></script><script>var preloader = {
  endLoading: () => {
    document.body.style.overflow = 'auto';
    document.getElementById('loading-box').classList.add("loaded")
  },
  initLoading: () => {
    document.body.style.overflow = '';
    document.getElementById('loading-box').classList.remove("loaded")

  }
}
window.addEventListener('load',preloader.endLoading())</script><div class="js-pjax"><script>function loadUtterances () {
  let ele = document.createElement('script')
  ele.setAttribute('id', 'utterances_comment')
  ele.setAttribute('src', 'https://utteranc.es/client.js')
  ele.setAttribute('repo', 'TeslaZY/comment-utterances')
  ele.setAttribute('issue-term', 'title')
  let nowTheme = document.documentElement.getAttribute('data-theme') === 'dark' ? 'github-dark' : 'github-light'
  ele.setAttribute('theme', nowTheme)
  ele.setAttribute('crossorigin', 'anonymous')
  ele.setAttribute('async', 'true')
  document.getElementById('utterances-wrap').insertAdjacentElement('afterbegin',ele)
}

function utterancesTheme () {
  const iframe = document.querySelector('.utterances-frame')
  if (iframe) {
    const theme = document.documentElement.getAttribute('data-theme') === 'dark' ? 'github-dark' : 'github-light'
    const message = {
      type: 'set-theme',
      theme: theme
    };
    iframe.contentWindow.postMessage(message, 'https://utteranc.es');
  }
}

if ('Utterances' === 'Utterances' || !false) {
  if (false) btf.loadComment(document.getElementById('utterances-wrap'), loadUtterances)
  else loadUtterances()
} else {
  function loadOtherComment () {
    loadUtterances()
  }
}</script></div><script defer="defer" id="fluttering_ribbon" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/canvas-fluttering-ribbon.min.js"></script><script>((window.gitter = {}).chat = {}).options = {
  disableDefaultChat: true,
};
document.addEventListener('gitter-sidecar-ready', (e) => {
  const GitterChat = e.detail.Chat
  let chat

  function initGitter () {
    chat = new GitterChat({
      room: 'TeslaZY/community',
      activationElement: '#chat_btn'
    });
  }

  initGitter()

  if (false) {
    document.addEventListener('pjax:complete', () => {
      chat.destroy()
      initGitter()
    })
  }

})</script><script src="https://sidecar.gitter.im/dist/sidecar.v1.js" async="async" defer="defer"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>